<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Gaia â€” Login</title>
  <link rel="stylesheet" href="css/style.css"/>
  <style>
    /* â”€â”€ Auth Page Layout â”€â”€ */
    body { background: var(--primary); min-height: 100vh; display: flex; align-items: center; justify-content: center; }

    .auth-wrap {
      display: grid; grid-template-columns: 1fr 1fr;
      width: min(960px, 95vw); min-height: 580px;
      border-radius: 20px; overflow: hidden;
      box-shadow: 0 30px 80px rgba(0,0,0,0.45);
    }

    /* Left panel â€” branding */
    .auth-brand {
      background: linear-gradient(150deg,#0a1f35 0%, #0f3a20 100%);
      padding: 3rem 2.5rem; display: flex; flex-direction: column;
      justify-content: space-between; position: relative; overflow: hidden;
    }
    .auth-brand::before {
      content:''; position:absolute; inset:0;
      background: radial-gradient(ellipse at 70% 30%, rgba(34,197,94,.15) 0%, transparent 60%);
    }
    .auth-brand-logo { font-size: 3rem; margin-bottom: .5rem; position: relative; }
    .auth-brand h1   { font-size: 2.4rem; font-weight: 900; color: #fff; position: relative; }
    .auth-brand h1 em { color: var(--green-light); font-style: normal; }
    .auth-brand p    { color: rgba(255,255,255,.6); font-size: .92rem; margin-top: .5rem; position: relative; }

    .auth-features { position: relative; }
    .auth-feat { display: flex; align-items: flex-start; gap: .75rem; margin-bottom: 1rem; }
    .auth-feat-icon { font-size: 1.1rem; flex-shrink: 0; margin-top: 1px; }
    .auth-feat p { font-size: .82rem; color: rgba(255,255,255,.7); line-height: 1.5; }
    .auth-feat strong { color: white; }

    .auth-brand-footer { font-size: .72rem; color: rgba(255,255,255,.35); position: relative; }

    /* Right panel â€” form */
    .auth-form-panel {
      background: #fff; padding: 2.5rem; display: flex;
      flex-direction: column; justify-content: center;
    }

    /* Tab switch */
    .auth-tabs { display: flex; gap: .5rem; margin-bottom: 1.75rem; }
    .auth-tab {
      flex: 1; padding: .55rem; border: 2px solid var(--border);
      border-radius: var(--radius-sm); background: none; cursor: pointer;
      font-size: .88rem; font-weight: 600; color: var(--text-muted);
      transition: all var(--t);
    }
    .auth-tab.active { border-color: var(--green); background: var(--success-bg); color: var(--green); }

    /* Role cards */
    .role-section { margin-bottom: 1.25rem; }
    .role-label { font-size: .78rem; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: .05em; margin-bottom: .6rem; }
    .role-cards { display: grid; grid-template-columns: repeat(5, 1fr); gap: .4rem; }
    .role-card {
      border: 2px solid var(--border); border-radius: var(--radius-sm);
      padding: .5rem .25rem; text-align: center; cursor: pointer;
      transition: all var(--t); background: var(--surface-alt);
    }
    .role-card:hover { border-color: var(--green-light); background: var(--success-bg); }
    .role-card.selected { border-color: var(--green); background: var(--success-bg); }
    .role-card .rc-icon { font-size: 1.3rem; display: block; margin-bottom: .15rem; }
    .role-card .rc-name { font-size: .62rem; font-weight: 600; color: var(--text-muted); line-height: 1.2; }
    .role-card.selected .rc-name { color: var(--green); }

    /* Form fields */
    .form-group { margin-bottom: 1rem; }
    .form-group label { display: block; font-size: .8rem; font-weight: 600; color: var(--text); margin-bottom: .35rem; }
    .form-group input, .form-group select {
      width: 100%; padding: .65rem .9rem; border: 1.5px solid var(--border);
      border-radius: var(--radius-sm); font-size: .9rem; color: var(--text);
      background: #fff; transition: border-color var(--t);
      font-family: inherit;
    }
    .form-group input:focus, .form-group select:focus { outline: none; border-color: var(--green); }
    .pw-wrap { position: relative; }
    .pw-wrap input { padding-right: 2.5rem; }
    .pw-toggle { position: absolute; right: .75rem; top: 50%; transform: translateY(-50%); cursor: pointer; font-size: 1rem; background: none; border: none; color: var(--text-muted); }

    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: .75rem; }

    /* Submit button */
    .auth-submit {
      width: 100%; padding: .8rem; background: var(--green); color: white;
      border: none; border-radius: var(--radius-sm); font-size: .95rem;
      font-weight: 700; cursor: pointer; transition: all var(--t); margin-top: .5rem;
    }
    .auth-submit:hover { background: #15803d; transform: translateY(-1px); box-shadow: 0 4px 14px rgba(22,163,74,.4); }
    .auth-submit:disabled { opacity: .6; cursor: default; transform: none; }

    /* Alerts */
    .auth-alert { padding: .7rem 1rem; border-radius: var(--radius-sm); font-size: .84rem; margin-bottom: 1rem; display: none; }
    .auth-alert.error.visible   { background: var(--danger-bg);  color: var(--danger);  border: 1px solid var(--danger-border); display: flex; gap: .5rem; align-items: center; }
    .auth-alert.success.visible { background: var(--success-bg); color: var(--success); border: 1px solid var(--success-border); display: flex; gap: .5rem; align-items: center; }

    /* Demo hint */
    .demo-hint {
      background: #f0f9ff; border: 1px solid #bae6fd; border-radius: var(--radius-sm);
      padding: .6rem .9rem; margin-top: .75rem; font-size: .76rem; color: #0369a1;
    }
    .demo-hint strong { display: block; margin-bottom: .25rem; }
    .demo-account { cursor: pointer; text-decoration: underline; color: #0284c7; }
    .demo-account:hover { color: #0f2942; }

    /* Decorative ring */
    .auth-brand-ring {
      position: absolute; bottom: -60px; right: -60px;
      width: 240px; height: 240px; border-radius: 50%;
      border: 40px solid rgba(34,197,94,.08);
    }

    /* Mobile */
    @media (max-width: 700px) {
      .auth-wrap { grid-template-columns: 1fr; }
      .auth-brand { display: none; }
      body { align-items: flex-start; padding: 1rem; }
      .auth-form-panel { border-radius: 16px; }
      .role-cards { grid-template-columns: repeat(3, 1fr); }
    }
  </style>
</head>
<body>

<div class="auth-wrap">
  <!-- â”€â”€ Brand Panel â”€â”€ -->
  <div class="auth-brand">
    <div>
      <div class="auth-brand-logo">ğŸŒ¿</div>
      <h1>Gaia<em>.</em></h1>
      <p>Smart IS-Code Compliant<br/>Building Design System</p>
    </div>

    <div class="auth-features">
      <div class="auth-feat">
        <span class="auth-feat-icon">ğŸ—</span>
        <p><strong>8-Step Design Workflow</strong> â€” from site analysis to full feasibility report</p>
      </div>
      <div class="auth-feat">
        <span class="auth-feat-icon">ğŸ“‹</span>
        <p><strong>IS Code Compliance</strong> â€” IS 456, IS 875, IS 1893, IS 13920, NBC</p>
      </div>
      <div class="auth-feat">
        <span class="auth-feat-icon">ğŸŒ±</span>
        <p><strong>Sustainability Score</strong> â€” compare your design against industry average</p>
      </div>
      <div class="auth-feat">
        <span class="auth-feat-icon">ğŸ‘¥</span>
        <p><strong>Team Access</strong> â€” role-based access for architects, engineers & clients</p>
      </div>
    </div>

    <p class="auth-brand-footer">Â© 2026 Gaia Smart Building Design System</p>
    <div class="auth-brand-ring"></div>
  </div>

  <!-- â”€â”€ Form Panel â”€â”€ -->
  <div class="auth-form-panel">
    <div id="auth-alert-error"   class="auth-alert error"></div>
    <div id="auth-alert-success" class="auth-alert success"></div>

    <!-- Tabs -->
    <div class="auth-tabs">
      <button class="auth-tab active" id="tab-login"    onclick="switchTab('login')">ğŸ”‘ Login</button>
      <button class="auth-tab"        id="tab-register" onclick="switchTab('register')">ğŸ“ Register</button>
    </div>

    <!-- LOGIN FORM -->
    <form id="login-form" onsubmit="handleLogin(event)">
      <div class="form-group">
        <label>Email Address</label>
        <input type="email" id="l-email" placeholder="you@example.com" required autocomplete="email"/>
      </div>
      <div class="form-group">
        <label>Password</label>
        <div class="pw-wrap">
          <input type="password" id="l-password" placeholder="Enter password" required autocomplete="current-password"/>
          <button type="button" class="pw-toggle" onclick="togglePw('l-password',this)">ğŸ‘</button>
        </div>
      </div>
      <button type="submit" class="auth-submit" id="login-btn">ğŸ”‘ Login to Gaia</button>

      <div class="demo-hint">
        <strong>ğŸ§ª Demo Accounts (password in brackets)</strong>
        <span class="demo-account" onclick="fillDemo('admin@gaia.com','Admin@123')">ğŸ‘‘ admin@gaia.com (Admin@123)</span> &nbsp;Â·&nbsp;
        <span class="demo-account" onclick="fillDemo('architect@gaia.com','Arch@123')">ğŸ› architect@gaia.com (Arch@123)</span> &nbsp;Â·&nbsp;
        <span class="demo-account" onclick="fillDemo('engineer@gaia.com','Eng@123')">ğŸ§± engineer@gaia.com (Eng@123)</span> &nbsp;Â·&nbsp;
        <span class="demo-account" onclick="fillDemo('client@gaia.com','Client@123')">ğŸ‘¤ client@gaia.com (Client@123)</span>
      </div>
    </form>

    <!-- REGISTER FORM -->
    <form id="register-form" onsubmit="handleRegister(event)" style="display:none;">
      <!-- Role selector -->
      <div class="role-section">
        <div class="role-label">Select Your Role</div>
        <div class="role-cards">
          <div class="role-card selected" onclick="selectRole('admin',this)"          data-role="admin">
            <span class="rc-icon">ğŸ‘‘</span><span class="rc-name">Admin</span>
          </div>
          <div class="role-card" onclick="selectRole('architect',this)"               data-role="architect">
            <span class="rc-icon">ğŸ“</span><span class="rc-name">Architect</span>
          </div>
          <div class="role-card" onclick="selectRole('structural_engineer',this)"     data-role="structural_engineer">
            <span class="rc-icon">ğŸ§±</span><span class="rc-name">Struct. Eng</span>
          </div>
          <div class="role-card" onclick="selectRole('client',this)"                  data-role="client">
            <span class="rc-icon">ğŸ‘¤</span><span class="rc-name">Client</span>
          </div>
          <div class="role-card" onclick="selectRole('cost_consultant',this)"         data-role="cost_consultant">
            <span class="rc-icon">ğŸ’°</span><span class="rc-name">Cost Consult</span>
          </div>
        </div>
        <input type="hidden" id="r-role" value="admin"/>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Full Name</label>
          <input type="text" id="r-name" placeholder="Your name" required/>
        </div>
        <div class="form-group">
          <label>Organization</label>
          <input type="text" id="r-org"  placeholder="Company (optional)"/>
        </div>
      </div>
      <div class="form-group">
        <label>Email Address</label>
        <input type="email" id="r-email" placeholder="you@example.com" required/>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label>Password</label>
          <div class="pw-wrap">
            <input type="password" id="r-password" placeholder="Min 6 chars" required/>
            <button type="button" class="pw-toggle" onclick="togglePw('r-password',this)">ğŸ‘</button>
          </div>
        </div>
        <div class="form-group">
          <label>Confirm Password</label>
          <div class="pw-wrap">
            <input type="password" id="r-confirm" placeholder="Repeat password" required/>
            <button type="button" class="pw-toggle" onclick="togglePw('r-confirm',this)">ğŸ‘</button>
          </div>
        </div>
      </div>
      <button type="submit" class="auth-submit" id="register-btn">ğŸš€ Create Account</button>
    </form>
  </div>
</div>

<script>
  const API = '/api/auth';

  /* â”€â”€ Tab switch â”€â”€ */
  function switchTab(tab) {
    document.getElementById('login-form').style.display    = tab === 'login'    ? '' : 'none';
    document.getElementById('register-form').style.display = tab === 'register' ? '' : 'none';
    document.getElementById('tab-login').classList.toggle('active',    tab === 'login');
    document.getElementById('tab-register').classList.toggle('active', tab === 'register');
    clearAlerts();
  }

  /* â”€â”€ Role cards â”€â”€ */
  let selectedRole = 'admin';
  function selectRole(role, el) {
    document.querySelectorAll('.role-card').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
    selectedRole = role;
    document.getElementById('r-role').value = role;
  }

  /* â”€â”€ Show/hide password â”€â”€ */
  function togglePw(id, btn) {
    const inp = document.getElementById(id);
    if (inp.type === 'password') { inp.type = 'text'; btn.textContent = 'ğŸ™ˆ'; }
    else                         { inp.type = 'password'; btn.textContent = 'ğŸ‘'; }
  }

  /* â”€â”€ Fill demo credentials â”€â”€ */
  function fillDemo(email, pw) {
    document.getElementById('l-email').value    = email;
    document.getElementById('l-password').value = pw;
  }

  /* â”€â”€ Alerts â”€â”€ */
  function showError(msg) {
    const el = document.getElementById('auth-alert-error');
    el.textContent = 'âš  ' + msg;
    el.classList.add('visible');
    document.getElementById('auth-alert-success').classList.remove('visible');
  }
  function showSuccess(msg) {
    const el = document.getElementById('auth-alert-success');
    el.textContent = 'âœ“ ' + msg;
    el.classList.add('visible');
    document.getElementById('auth-alert-error').classList.remove('visible');
  }
  function clearAlerts() {
    document.getElementById('auth-alert-error').classList.remove('visible');
    document.getElementById('auth-alert-success').classList.remove('visible');
  }

  /* â”€â”€ Handle Login â”€â”€ */
  async function handleLogin(e) {
    e.preventDefault(); clearAlerts();
    const btn = document.getElementById('login-btn');
    btn.disabled = true; btn.textContent = 'â³ Logging inâ€¦';
    try {
      const res = await fetch(API + '/login', {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email: document.getElementById('l-email').value, password: document.getElementById('l-password').value })
      });
      const data = await res.json();
      if (!data.success) throw new Error(data.message);
      localStorage.setItem('gaia_token', data.token);
      localStorage.setItem('gaia_user',  JSON.stringify(data.user));
      showSuccess('Welcome back, ' + data.user.name + '! Redirectingâ€¦');
      const redirect = localStorage.getItem('gaia_redirect') || 'index.html';
      localStorage.removeItem('gaia_redirect');
      setTimeout(() => window.location.href = redirect, 900);
    } catch (err) {
      showError(err.message || 'Login failed. Please try again.');
    } finally {
      btn.disabled = false; btn.textContent = 'ğŸ”‘ Login to Gaia';
    }
  }

  /* â”€â”€ Handle Register â”€â”€ */
  async function handleRegister(e) {
    e.preventDefault(); clearAlerts();
    const pw  = document.getElementById('r-password').value;
    const cpw = document.getElementById('r-confirm').value;
    if (pw !== cpw) return showError('Passwords do not match');
    if (pw.length < 6) return showError('Password must be at least 6 characters');
    const btn = document.getElementById('register-btn');
    btn.disabled = true; btn.textContent = 'â³ Creating accountâ€¦';
    try {
      const res = await fetch(API + '/register', {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          name:         document.getElementById('r-name').value,
          email:        document.getElementById('r-email').value,
          password:     pw,
          role:         selectedRole,
          organization: document.getElementById('r-org').value,
        })
      });
      const data = await res.json();
      if (!data.success) throw new Error(data.message);
      localStorage.setItem('gaia_token', data.token);
      localStorage.setItem('gaia_user',  JSON.stringify(data.user));
      showSuccess('Account created! Welcome, ' + data.user.name + '! Redirectingâ€¦');
      setTimeout(() => window.location.href = 'index.html', 1200);
    } catch (err) {
      showError(err.message || 'Registration failed. Please try again.');
    } finally {
      btn.disabled = false; btn.textContent = 'ğŸš€ Create Account';
    }
  }
</script>
</body>
</html>
